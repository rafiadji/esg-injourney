{% extends 'base.html' %}

{% block title %}
  Master Entity
{% endblock %}

{% block head %}
  <style type="text/css">
    .boxs {
      height: 400px;
      position: relative;
      border: 3px solid green;
    }
    
    .boxs p {
      margin: 0;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
{% endblock %}

{% block content %}
  <section>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12 col-sm-12 p-0">
          <section class="section esg-hero-idx" id="hero" style="background-image: url('assets/images/addindic.jpg'); background-position: center center; height: 434px;">
            <div class="bg-overlay"></div>
            <div class="container-fluid">
              <div class="row">
                <div class="col-lg-7 col-sm-10">
                  <div class="p-5" style="margin: 0;  position: absolute; top: 50%;  left: 0%; transform: translateY(40%);">
                    <h1 class="display-8 fw-medium mb-4 lh-base text-white"><a href="master/entity" class="text-white mt-4"><i class="ri-arrow-left-line align-bottom me-1"></i></a>Add New Entity</h1>
                  </div>
                </div>
                <!-- end col -->
              </div>
              <!-- end row -->
            </div>
            <!-- end container -->
          </section>
        </div>
      </div>
    </div>
  </section>
  <section>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12 p-5">
          <h2 class="heading-txt fw-semibold text-black">Form Entity</h2>
          <form action="" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row gy-4 pt-2">
              <div class="col-12">
                <h5>Entity Name</h5>
                <div class="col-5">
                  <input type="text" class="form-control" name="pic" placeholder="Entity Name" value="{{ entity_edit.pic }}" />
                </div>
              </div>
              <div class="col-12">
                <div class="d-flex align-items-center">
                  <div class="flex-grow-1"></div>
                  <div class="flex-shrink-0">
                    <div class="d-flex flex-wrap gap-2">
                      <a href="javascript:;" class="btn btn-success active" id="add-subindicator" onclick="add_sub()"><span class="icon-on"><i class="ri-add-line align-bottom me-1"></i> Add New Group</span></a>
                    </div>
                  </div>
                </div>
                <div class="pt-5">
                  <table class="table table-nowrap" id="master-group">
                    <thead>
                      <tr>
                        <th scope="col">Group Name</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    <tbody>
                      {% if group_edit %}
                        {% for grp in group_edit %}
                          <tr>
                            <td>
                              <input type="hidden" name="group_id" value="{{ grp.id }}" >
                              <input type="text" class="form-control" name="group" placeholder="Group Name" value="{{ grp.group }}" />
                            </td>
                            <td>
                              <button type="button" class="btn btn-ghost-danger waves-effect waves-light shadow-none delete-sub-edit" data-sub="{{ grp.id }}">Delete Group</button>
                            </td>
                          </tr>
                        {% endfor %}
                      {% endif %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="row gy-4 pt-2" style="align-items: right; float: right;">
              <div>
                <a href="master/entity" class="btn btn-ghost-danger waves-effzect waves-light shadow-none">Cancel</a>
                <button type="submit" class="btn btn-success waves-effect waves-light"><i class="ri-save-line align-middle fs-16 me-2"></i> Save</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block script %}
  <script>
    var table_sub = $('#master-group').DataTable({
      ordering: false,
      searching: false,
      lengthChange: false,
      paging: false,
      info: false
    })
    
    function add_sub() {
      table_sub.row.add([`<input type="hidden" name="group_id" value="" > <input type="text" class="form-control" name="group" placeholder="Group Name" />`, `<button type="button" class="btn btn-ghost-danger waves-effect waves-light shadow-none delete-sub">Delete Group</button>`]).draw()
    }
    
    $('#master-group').on('click', '.delete-sub', function () {
      table_sub.row($(this).closest('tr')).remove().draw()
    })
    
    $('#master-group').on('click', '.delete-sub-edit', function () {
      Swal.fire({
        title: 'Are you sure?',
        text: 'Deleted group cannot be restored!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ya, Hapus!',
        cancelButtonText: 'Batal'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: `master/delete_grp/${$(this).data('sub')}`,
            dataType: 'json',
            async: true,
            success: (res) => {
              table_sub.row($(this).closest('tr')).remove().draw()
            }
          })
        }
      })
    })
  </script>
{% endblock %}
